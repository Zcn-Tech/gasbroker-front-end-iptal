<div
  class="
    absolute
    inset-0
    flex flex-col
    min-w-0
    overflow-hidden
    bg-card
    dark:bg-transparent
  "
>
  <!-- Header -->
  <div
    class="
      relative
      flex flex-col
      sm:flex-row
      flex-0
      sm:items-center sm:justify-between
      py-8
      px-6
      md:px-8
      border-b
    "
  >
    <!-- Loader -->
    <div class="absolute inset-x-0 bottom-0" *ngIf="isLoading">
      <mat-progress-bar [mode]="'indeterminate'"></mat-progress-bar>
    </div>
    <!-- Title -->
    <div class="text-4xl font-extrabold tracking-tight">Products</div>
    <!-- Actions -->
    <div class="flex flex-shrink-0 items-center mt-6 sm:mt-0 sm:ml-4">
      <!-- Search -->
      <mat-form-field class="fuse-mat-dense fuse-mat-no-subscript min-w-50">
        <mat-icon matPrefix [svgIcon]="'heroicons_outline:search'"></mat-icon>
        <input
          matInput
          [formControl]="searchInputControl"
          [autocomplete]="'off'"
          [placeholder]="'Search products'"
        />
      </mat-form-field>
      <!--Add product button -->
      <button
        class="ml-4"
        mat-flat-button
        [color]="'primary'"
        (click)="createProduct()"
      >
        <mat-icon [svgIcon]="'heroicons_outline:plus'"></mat-icon>
        <span class="ml-2 mr-1">Add</span>
      </button>
    </div>
  </div>
  <!-- Main -->
  <div class="flex flex-auto overflow-hidden">
    <!-- Products list -->
    <div class="flex flex-col flex-auto sm:mb-18 overflow-hidden">
      <ng-container *ngIf="productsCount > 0; else noProducts">
        <!-- Table wrapper -->
        <div class="overflow-x-auto sm:overflow-y-auto" cdkScrollable>
          <!-- Table -->
          <table
            class="w-full min-w-320 table-fixed bg-transparent"
            [ngClass]="{ 'pointer-events-none': isLoading }"
            mat-table
            matSort
            [matSortActive]="'name'"
            [matSortDisableClear]="true"
            [matSortDirection]="'asc'"
            [multiTemplateDataRows]="true"
            [dataSource]="products$"
            [trackBy]="trackByFn"
          >
            <!-- Name -->
            <ng-container matColumnDef="name">
              <th
                class="bg-gray-50 dark:bg-black dark:bg-opacity-5"
                mat-header-cell
                *matHeaderCellDef
                mat-sort-header
                disableClear
              >
                Product Name
              </th>
              <td class="pr-8 truncate" mat-cell *matCellDef="let product">
                {{ product.name }}
              </td>
            </ng-container>

            <!-- Code -->
            <ng-container matColumnDef="code">
              <th
                class="bg-gray-50 dark:bg-black dark:bg-opacity-5"
                mat-header-cell
                *matHeaderCellDef
                mat-sort-header
                disableClear
              >
                Product Code
              </th>
              <td class="pr-8 truncate" mat-cell *matCellDef="let product">
                {{ product.code }}
              </td>
            </ng-container>

            <!-- Active -->
            <ng-container matColumnDef="active">
              <th
                class="w-24 bg-gray-50 dark:bg-black dark:bg-opacity-5"
                mat-header-cell
                *matHeaderCellDef
                mat-sort-header
                disableClear
              >
                Active
              </th>
              <td class="pr-4" mat-cell *matCellDef="let product">
                <mat-icon
                  class="text-green-400 icon-size-5"
                  *ngIf="product.active"
                  [svgIcon]="'heroicons_solid:check'"
                ></mat-icon>
                <mat-icon
                  class="text-gray-400 icon-size-5"
                  *ngIf="!product.active"
                  [svgIcon]="'heroicons_solid:x'"
                ></mat-icon>
              </td>
            </ng-container>

            <!-- Details -->
            <ng-container matColumnDef="details">
              <th
                class="w-24 pr-8 bg-gray-50 dark:bg-black dark:bg-opacity-5"
                mat-header-cell
                *matHeaderCellDef
              >
                Details
              </th>
              <td class="pr-8" mat-cell *matCellDef="let product">
                <button
                  class="min-w-10 min-h-7 h-7 px-2 leading-6"
                  mat-stroked-button
                  (click)="toggleDetails(product.id)"
                >
                  <mat-icon
                    class="icon-size-5"
                    [svgIcon]="
                      selectedProduct?.id === product.id
                        ? 'heroicons_solid:chevron-up'
                        : 'heroicons_solid:chevron-down'
                    "
                  >
                  </mat-icon>
                </button>
              </td>
            </ng-container>

            <!-- Product details row -->
            <ng-container matColumnDef="productDetails">
              <td
                class="p-0 border-b-0"
                mat-cell
                *matCellDef="let product"
                [attr.colspan]="productsTableColumns.length"
              >
                <ng-container *ngIf="selectedProduct?.id === product.id">
                  <ng-container
                    *ngTemplateOutlet="
                      rowDetailsTemplate;
                      context: { $implicit: product }
                    "
                  >
                  </ng-container>
                </ng-container>
              </td>

              <ng-template #rowDetailsTemplate let-product>
                <div
                  class="shadow-lg overflow-hidden"
                  [@expandCollapse]="
                    selectedProduct?.id === product.id
                      ? 'expanded'
                      : 'collapsed'
                  "
                >
                  <div class="flex border-b">
                    <!-- Selected product form -->
                    <form
                      class="flex flex-col w-full"
                      [formGroup]="selectedProductForm"
                    >
                      <div class="flex p-8">
                        <!-- Product images and status -->
                        <div class="flex flex-col">
                          <div class="flex flex-col items-center"></div>
                          <div class="flex flex-col mt-8">
                            <span class="font-semibold mb-2"
                              >Product status</span
                            >
                            <mat-slide-toggle
                              [formControlName]="'active'"
                              (click)="updateActive()"
                              [color]="'primary'"
                            >
                              {{
                                selectedProductForm.get("active").value === true
                                  ? "Active"
                                  : "Disabled"
                              }}
                            </mat-slide-toggle>
                          </div>
                        </div>

                        <div class="flex flex-auto">
                          <div class="flex flex-col w-2/4 pl-8">
                            <mat-form-field class="w-full">
                              <mat-label>Name</mat-label>
                              <input
                                matInput
                                [formControlName]="'name'"
                              />
                            </mat-form-field>
                            <div class="flex">
                              <mat-form-field class="w-1/3 px-2">
                                <mat-label> Product Code</mat-label>
                                <input
                                matInput
                                [formControlName]="'code'"
                              />
                              </mat-form-field>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div
                        class="
                          flex
                          items-center
                          justify-between
                          w-full
                          border-t
                          px-8
                          py-4
                        "
                      >
                        <div class="flex items-center">
                          <div
                            class="flex items-center mr-4"
                            *ngIf="flashMessage"
                          >
                            <ng-container *ngIf="flashMessage === 'success'">
                              <mat-icon
                                class="text-green-500"
                                [svgIcon]="'heroicons_outline:check'"
                              ></mat-icon>
                              <span class="ml-2">Product updated</span>
                            </ng-container>
                            <ng-container *ngIf="flashMessage === 'error'">
                              <mat-icon
                                class="text-red-500"
                                [svgIcon]="'heroicons_outline:x'"
                              ></mat-icon>
                              <span class="ml-2"
                                >An error occurred, try again!</span
                              >
                            </ng-container>
                          </div>
                          <button
                            mat-flat-button
                            [color]="'primary'"
                            (click)="updateSelectedProduct()"
                          >
                            Update
                          </button>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </ng-template>
            </ng-container>

            <tr
              class="shadow"
              mat-header-row
              *matHeaderRowDef="productsTableColumns; sticky: true"
            ></tr>
            <tr
              class="h-18 hover:bg-gray-100 dark:hover:bg-hover"
              mat-row
              *matRowDef="let product; columns: productsTableColumns"
            ></tr>
            <tr
              class="h-0"
              mat-row
              *matRowDef="let row; columns: ['productDetails']"
            ></tr>
          </table>
        </div>
      </ng-container>

      <ng-template #noProducts>
        <div
          class="
            p-8
            sm:p-16
            border-t
            text-4xl
            font-semibold
            tracking-tight
            text-center
          "
        >
          There are no products!
        </div>
      </ng-template>
    </div>
  </div>
</div>
